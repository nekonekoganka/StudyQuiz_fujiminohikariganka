# ひかり眼科 学習クイズ

**[クイズに挑戦する](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/)**

ふじみ野ひかり眼科のスタッフ向け学習クイズアプリです。

> **スマートフォン最適化**
> このアプリは主にスマートフォンでの利用を想定して設計されています。
> 休憩時間や移動中など、いつでもどこでも手軽に学習できます。

## クイズ一覧

### メガネ・コンタクト系

| クイズ名 | 内容 |
|---------|------|
| [CL処方クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/コンタクト処方の基本クイズ.html) | コンタクトレンズの処方に関する基本知識 |
| [遠用メガネのクイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/大人の遠く用メガネ合わせクイズ.html) | 大人の遠用メガネ処方の知識 |
| [老眼鏡合わせクイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/老眼鏡合わせ_クイズ.html) | 老眼鏡合わせに関する基本知識 |

### 疾患系

| クイズ名 | 内容 |
|---------|------|
| [近視クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/近視についてのクイズ.html) | 近視の基礎知識と患者様への説明ポイント |
| [花粉症クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/花粉症についてのクイズ.html) | 花粉症の症状や対処法についての知識 |
| [白内障クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/白内障についてクイズ.html) | 白内障の基礎知識と患者様への説明ポイント |
| [緑内障クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/緑内障についてクイズ.html) | 緑内障について正しく理解するためのクイズ |
| [弱視クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/弱視クイズ.html) | 弱視の基礎知識と保護者への説明ポイント |
| [斜視クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/斜視クイズ.html) | 斜視の基礎知識と保護者への説明ポイント |

### ルール・検診系

| クイズ名 | 内容 |
|---------|------|
| [検診の制度クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/自治体の緑内障検診の制度のクイズ.html) | 自治体の緑内障検診制度についての知識 |
| [院内ルール確認クイズ](https://nekonekoganka.github.io/StudyQuiz_fujiminohikariganka/quizzes/院内ルール確認クイズ.html) | 休診日、予約ルール、受付時間など院内の基本ルール |

## 機能

- 複数の出題モード（3問/5問/7問/フルコース）
- 選択肢のランダムシャッフル
- 正誤フィードバックと解説表示
- スコア表示と結果評価
- **マイページ**: 学習進捗の確認、実績バッジ
- スマートフォン最適化（タップ操作に最適化されたUI）
- iPhoneセーフエリア対応（ノッチ・ホームバー）

## 使い方

1. 上記リンクからクイズページにアクセス
2. 出題モードを選択
3. 選択肢をタップして回答
4. 解説を確認して次の問題へ
5. **マイページ**で学習進捗を確認

## 推奨環境

- **スマートフォン**（iPhone / Android）
- Safari / Chrome などのモダンブラウザ
- PC・タブレットでも利用可能

---

## マイページ機能

トップページ下部の「マイページ」から、学習進捗を確認できます。

### 進捗表示

| マーク | 意味 |
|--------|------|
| ー | 未挑戦 |
| ⭐ | 挑戦済み |
| 🌸 | 満点達成 |
| 🏆 | 全クイズコンプリート |

### 実績バッジ

| バッジ | 名前 | 条件 |
|--------|------|------|
| 🔰 | はじめの一歩 | どれかのクイズに1回挑戦 |
| 🌱 | コツコツ学習 | 合計で50問以上回答 |
| 🔥 | 熱心な挑戦者 | 合計で10回以上クイズに挑戦 |
| 💯 | 100問突破 | 合計で100問以上回答 |
| 📚 | 全制覇 | すべてのクイズに1回以上挑戦 |
| 🌸 | 満点達成 | どれかのクイズの「全問」モードで満点を取る |
| ⭐ | トリプル満点 | 3つ以上のクイズの「全問」モードで満点を取る |
| 📖 | 勉強家 | 合計で200問以上回答 |
| 💎 | ハーフ満点 | 6つ以上のクイズの「全問」モードで満点を取る |
| 👑 | クイズマスター | すべてのクイズの「全問」モードで満点を取る |

### データについて

- データはブラウザの LocalStorage に保存されます
- サーバーには送信されません
- ブラウザのデータを消去すると進捗もリセットされます
- **バックアップ機能**: 設定画面から学習データをJSONファイルで保存・復元できます

---

## 開発者向け情報

### ファイル構成

```
├── index.html                      # トップページ
├── mypage.html                     # マイページ（進捗確認）
├── quizzes/
│   ├── quiz-config.js              # クイズ設定ファイル（重要）
│   ├── 院内ルール確認クイズ.html
│   ├── コンタクト処方の基本クイズ.html
│   ├── 花粉症についてのクイズ.html
│   ├── 緑内障についてクイズ.html
│   ├── 老眼鏡合わせ_クイズ.html
│   ├── 近視についてのクイズ.html
│   ├── 斜視クイズ.html
│   ├── 大人の遠く用メガネ合わせクイズ.html
│   ├── 弱視クイズ.html
│   ├── 白内障についてクイズ.html
│   └── 自治体の緑内障検診の制度のクイズ.html
├── docs/
│   └── QUIZ_SPECIFICATION.md       # クイズHTML仕様書（詳細版）
├── QUIZ_SPEC.md                    # クイズHTML仕様書（簡易版）
└── README.md                       # このファイル
```

---

## 新しいクイズを追加する方法

### 手順1: quiz-config.js にエントリを追加

`quizzes/quiz-config.js` の `QUIZ_LIST` 配列に新しいクイズを追加します。

```javascript
const QUIZ_LIST = [
    // 既存のクイズ...

    // 新しいクイズを追加
    {
        id: 'new-quiz',                    // 一意のID（英数字・ハイフン）
        name: '新しいクイズ',               // 表示名
        file: '新しいクイズ.html',          // ファイル名
        totalQuestions: 10,                // 総問題数
        icon: '📝',                        // アイコン絵文字
        category: 'staff',                 // 'staff' または 'patient'
        description: 'クイズの説明文',      // 説明
        color: 'blue'                      // カードの色（blue/cyan/teal/green/amber/purple/indigo）
    }
];
```

#### 利用可能なカラーテーマ
- `blue` - 青系（院内ルール、近視など）
- `cyan` - シアン系（コンタクトレンズ、白内障）
- `teal` - ティール系（花粉症）
- `green` - 緑系（緑内障理解度）
- `amber` - 琥珀色系（老眼鏡合わせ、遠用メガネ）
- `purple` - 紫系（斜視、弱視）
- `indigo` - インディゴ系（緑内障検診）

### 手順2: 新しいクイズHTMLを作成

既存のクイズHTMLをコピーして、以下を変更します。

#### 必須の変更箇所

**1. タイトル・見出し**: クイズ名に変更

**2. QUIZ_ID の設定**: quiz-config.js で設定した `id` と一致させる

```html
<script src="quiz-config.js"></script>
<script>
    const QUIZ_ID = 'new-quiz';  // ← quiz-config.js の id と一致させる
```

**3. 問題数の設定**:

```javascript
let totalQuestions = 10;  // 問題数
const allQuestions = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];  // 問題番号の配列
```

**4. 問題と選択肢の内容**:

```html
<div id="question1" class="question-card hidden">
    <div class="question-number">Q1</div>
    <div class="question-text">問題文をここに書く</div>
    <div class="options">
        <button class="option" data-answer="true">正解の選択肢</button>
        <button class="option" data-answer="false">不正解の選択肢</button>
        <!-- 選択肢を追加 -->
    </div>
    <div class="feedback"></div>
    <div class="explanation hidden">
        <strong>解説:</strong> 解説文をここに書く
    </div>
</div>
```

**5. resetQuiz / goHome 内のループ数**: 問題数に合わせる

```javascript
for (let i = 1; i <= 10; i++) {  // ← 問題数に変更
```

### 手順3: 動作確認

1. トップページにクイズが表示されることを確認
2. クイズを最後まで実行して結果が表示されることを確認
3. マイページに進捗が記録されることを確認

---

## 既存クイズに問題を追加する場合

既存のクイズHTMLに新しい問題を追加する際は、以下の**すべて**を更新してください：

| 更新箇所 | 説明 |
|----------|------|
| `totalQuestions` 変数 | ファイル上部の問題数 |
| `allQuestions` 配列 | 問題番号の配列に新しい番号を追加 |
| `startQuiz` 関数内のループ | `for (let i = 1; i <= N; i++)` のNを更新 |
| `resetQuiz` 関数内のループ | 同上 |
| `goHome` 関数内のループ | 同上 |
| `goHome` 関数内の `totalQuestions` | リセット時の問題数 |
| モードボタンの表示 | 「全N問」の表示を更新 |
| モード説明文 | 「全N問から〜」の説明を更新 |
| `quiz-config.js` | `totalQuestions` の値を更新 |

> **注意**: ループの上限値を更新し忘れると、新しい問題が常に表示されたままになるバグが発生します。

> **✅ 自動更新**: トップページ（index.html）の問題数表示は `quiz-config.js` から自動的に取得されるため、手動更新は不要です。

---

## UI/UX仕様（統一ルール）

新しいクイズを追加する際は、以下の仕様を守ってください。

### スクロール動作

回答後のスクロールは、フィードバック（正解/不正解）が**画面上部**に来るように設定します。

```javascript
// スマホ用：回答後にフィードバックが画面上部に来るようスクロール
setTimeout(() => {
    feedback.scrollIntoView({ behavior: 'smooth', block: 'start' });
}, 100);
```

- `block: 'start'` を使用（`center` ではない）
- これにより選択肢は画面外になり、フィードバックと解説が見やすくなります

### 結果画面のボタン配置

結果画面には3つのボタンを表示します：

| ボタン | 色 | 用途 |
|--------|------|------|
| 🔄 モード選択 | オレンジ | 同じクイズを別モードで再挑戦 |
| 📊 学習記録 | ティール | マイページへ移動 |
| 🏠 ホーム | 紫 | トップページへ移動 |

---

## クイズHTMLの詳細仕様

詳細な仕様は以下を参照してください：
- [docs/QUIZ_SPECIFICATION.md](./docs/QUIZ_SPECIFICATION.md) - 詳細版（Claude Code用）
- [QUIZ_SPEC.md](./QUIZ_SPEC.md) - 簡易版

---

## デプロイ

GitHub Pages で静的サイトとしてホスティングできます。

1. リポジトリの Settings → Pages を開く
2. Source で `main` ブランチを選択
3. 保存すると自動的にデプロイされます

---

## 開発ログ・進捗

### 2025年1月 トップページ問題数の動的表示

#### 実装した機能

| 項目 | 内容 |
|------|------|
| 問題数の自動更新 | トップページのクイズカードに表示される問題数が `quiz-config.js` から自動取得されるように |

#### 技術詳細

`index.html` に `updateQuizCounts()` 関数を追加。ページ読み込み時に `QUIZ_LIST` を参照し、各クイズカードの `data-quiz-id` 属性に基づいて問題数を自動更新します。

```javascript
function updateQuizCounts() {
    document.querySelectorAll('.quiz-card[data-quiz-id]').forEach(card => {
        const quizId = card.dataset.quizId;
        const quizInfo = QUIZ_LIST.find(q => q.id === quizId);
        if (quizInfo) {
            const countElement = card.querySelector('.quiz-count');
            if (countElement) {
                countElement.textContent = `全${quizInfo.totalQuestions}問`;
            }
        }
    });
}
```

#### メリット

- 問題数を変更した際、`quiz-config.js` の `totalQuestions` を更新するだけでOK
- トップページの手動更新が不要になり、更新漏れを防止

---

### 2025年1月 「今日の3問」弱点優先機能

#### 実装した機能

| 項目 | 内容 |
|------|------|
| 弱点優先の重み付け選択 | 「今日の3問」ボタンで苦手なクイズが優先的に選ばれるように |
| ローカルルールクイズの除外 | 院内ルール・検診クイズはランダム選択から除外 |

#### 重み付けアルゴリズム

「今日の3問」およびクイズ終了後の「次のクイズへ」で、以下の重み付けでクイズが選択されます：

| 条件 | 重み |
|------|------|
| 未挑戦の問題が多い | ×10 |
| 間違えた問題が多い | ×5 |
| まだ満点を取っていない | +20 |
| 満点達成済み | 最低1（ほぼ選ばれない） |

**計算式**: `(未挑戦数 × 10) + (間違い数 × 5) + (未マスター ? 20 : 0)`

#### ランダム選択から除外されるクイズ

以下のクイズはローカルルールのため、ランダム選択の対象外です：

| クイズID | クイズ名 | 理由 |
|----------|----------|------|
| `innai-rule` | 院内ルール確認クイズ | 院内固有のルール |
| `ryokunaisho-kenshin` | 検診の制度クイズ | 自治体固有の制度 |

> **注**: これらのクイズはトップページから直接選択すれば挑戦できます。

#### 対象ファイル

| ファイル | 変更内容 |
|----------|----------|
| index.html | `startRandomQuiz()`に重み付け選択を実装 |
| quizzes/quiz-config.js | `getWeightedRandomQuiz()`に除外リストを追加 |

---

### 2025年1月 設定ページ改善・データバックアップ機能追加

#### 実装した機能

| 項目 | 内容 |
|------|------|
| データバックアップ | 学習データをJSONファイルで保存・復元可能に |
| 設定アコーディオン | 設定をアコーディオン形式に変更（デフォルト閉じ） |
| バッジ3列表示 | 実績バッジを3列グリッドでコンパクトに表示 |
| ダークモード自動対応 | 手動設定を廃止、デバイス設定に完全依存 |
| 動的ボタンテキスト | クイズ結果画面のボタンが設定の問題数（3/5/7）を反映 |

#### 修正した問題

| 問題 | 対応 |
|------|------|
| 設定ページでバッジ・進捗が表示されない | エラーハンドリング追加、設定キー読込修正 |
| トグルスイッチの表示崩れ | トグルUI自体を削除（効果音・アニメーション設定廃止） |
| ダークモード時の色バランス崩れ | force-light/force-dark CSSを削除、prefers-color-scheme に統一 |
| 結果ボタンの問題数がハードコード | getDailyQuestionCount()から動的に取得するよう修正 |

#### 設定ページの構成変更

**Before:**
```
📊 大きなアイコン
統計情報
クイズ進捗
実績バッジ（2列）
```

**After:**
```
⚙️ 設定（アコーディオン・デフォルト閉じ）
  ├─ 文字の大きさ（小・標準・大きめ）
  ├─ 今日の問題数（3問・5問・7問）
  └─ データバックアップ（💾バックアップ / 📂復元）
統計情報
クイズ進捗
実績バッジ（3列）
```

#### データバックアップ機能

キャッシュ削除に備えて学習データを保存できる機能を追加。

| 操作 | 説明 |
|------|------|
| 💾 バックアップ | 進捗・バッジ・設定をJSONファイルでダウンロード |
| 📂 復元 | バックアップファイルを読み込んでデータを復元 |

**保存されるデータ:**
- クイズ進捗（正解した問題、挑戦回数など）
- 実績バッジ
- 設定（文字サイズ、問題数）

#### 対象ファイル

| ファイル | 変更内容 |
|----------|----------|
| mypage.html | 設定アコーディオン、3列バッジ、バックアップ機能追加 |
| index.html | ダークモードCSS修正 |
| css/quiz.css | force-light/force-dark CSS削除 |
| quizzes/quiz-config.js | applyDarkMode関数削除 |
| 全11クイズHTML | 結果ボタンの動的テキスト対応 |

---

### 2025年1月 UI/UX改善

#### 実装した機能

| 項目 | 内容 |
|------|------|
| クイズ進捗UI | コンパクトな1行表示に変更（問題 1/15 ・ 正解: 0） |
| リザルト画面ボタン | 4つのボタンに変更（シャッフル3問、もう3問、記録、ホーム） |
| ボタンの視認性改善 | グラデーションからソリッドカラーに変更 |
| モバイル余白削減 | padding/marginを最適化して画面を有効活用 |
| ボタンサイズ統一 | リザルト画面の4ボタンを同じサイズの2x2グリッドに |

#### 修正したバグ・不具合

| 問題 | 原因 | 対応 |
|------|------|------|
| シャッフル3問ボタンが正しく動作しない | 一部ファイルで`restartThisQuiz()`が`resetQuiz()`を呼んでいた | URL遷移 + `?mode=daily3`パラメータに統一 |
| レッドグリーンテスト問題の正答が逆 | 「赤がはっきり見える」の解釈が逆だった | 正答と解説を修正、遠視の注記を追加 |
| モバイルでボタンが小さく押しづらい | padding/font-sizeが小さすぎた | 統一されたサイズに変更 |

#### 対象ファイル（シャッフルボタン修正）

- 近視についてのクイズ.html
- 老眼鏡合わせ_クイズ.html
- 花粉症についてのクイズ.html
- 院内ルール確認クイズ.html

---

## 設計方針

### 視認性・操作性を最重視

このアプリはスマートフォンでの利用を前提としているため、以下の点を重視しています：

#### タップしやすさ
- ボタンは**44px以上**のタップ領域を確保
- 余白を適切に取り、誤タップを防止
- 重要なボタンは大きく、目立つ色で表示

#### 見やすさ
- **高コントラスト**な色使い（白文字 + ソリッドカラー背景）
- グラデーションより視認性の高い単色を採用
- フォントサイズは読みやすい大きさを維持

#### シームレスな体験
- クイズ終了後すぐに次のクイズへ移動可能
- モード選択画面を経由せず直接クイズ開始
- 学習記録へのアクセスも1タップ

#### カラーパレット（リザルトボタン）

| ボタン | 色 | カラーコード |
|--------|------|-------------|
| シャッフル3問 | ピンク | `#e91e63` |
| もう3問 | ブルー | `#1976d2` |
| 記録 | ティール | `#00897b` |
| ホーム | パープル | `#5e35b1` |

---

## ライセンス

プライベートリポジトリ - ふじみ野ひかり眼科
