<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>è¨­å®š - ã²ã‹ã‚Šçœ¼ç§‘ å­¦ç¿’ã‚¯ã‚¤ã‚º</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/icon-180.png">
    <meta name="theme-color" content="#667eea">
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 12px;
            padding-top: max(12px, env(safe-area-inset-top));
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            padding-left: max(12px, env(safe-area-inset-left));
            padding-right: max(12px, env(safe-area-inset-right));
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.7;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 28px 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 28px;
        }

        h1 {
            color: #1a237e;
            font-size: 24px;
            margin: 0 0 8px 0;
        }

        .subtitle {
            color: #5c6bc0;
            font-size: 14px;
        }

        .section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #1a237e;
            margin: 0 0 16px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8eaf6;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-item {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .setting-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 6px;
            font-size: 15px;
        }

        .setting-description {
            color: #666;
            font-size: 13px;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .button-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .selector-button {
            flex: 1;
            min-width: 70px;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .selector-button:active {
            transform: scale(0.95);
        }

        .selector-button.active {
            border-color: #5c6bc0;
            background: linear-gradient(135deg, #667eea, #5c6bc0);
            color: white;
        }

        .backup-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .backup-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            border: 2px solid #5c6bc0;
            border-radius: 10px;
            background: white;
            color: #5c6bc0;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .backup-button:active {
            transform: scale(0.95);
        }

        .backup-button.restore {
            border-color: #26a69a;
            color: #26a69a;
        }

        .last-backup-info {
            margin-top: 12px;
            font-size: 13px;
            color: #666;
        }

        .danger-zone {
            background: #fff5f5;
            border-radius: 12px;
            padding: 16px;
            margin-top: 24px;
        }

        .danger-zone .section-title {
            color: #c62828;
            border-bottom-color: #ffcdd2;
        }

        .reset-button {
            width: 100%;
            padding: 12px;
            border: 2px solid #ef5350;
            border-radius: 10px;
            background: white;
            color: #c62828;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        .reset-button:active {
            transform: scale(0.95);
        }

        .footer {
            text-align: center;
            margin-top: 28px;
            padding-top: 20px;
            border-top: 2px solid #e8eaf6;
        }

        .home-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #5c6bc0);
            color: white;
            text-decoration: none;
            padding: 12px 28px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: bold;
        }

        .home-link:active {
            transform: scale(0.95);
        }

        /* å¾©å…ƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .restore-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .restore-modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 340px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .restore-preview-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .restore-preview-title.success { color: #2e7d32; }
        .restore-preview-title.error { color: #c62828; }
        .restore-preview-info {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .restore-preview-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .restore-preview-row:last-child { border-bottom: none; }
        .restore-preview-label { color: #666; }
        .restore-preview-value { font-weight: bold; color: #333; }
        .restore-warning {
            background: #fff3e0;
            color: #e65100;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            margin-bottom: 16px;
        }
        .restore-error-message {
            background: #ffebee;
            color: #c62828;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 16px;
            line-height: 1.6;
        }
        .restore-modal-buttons {
            display: flex;
            gap: 10px;
        }
        .restore-modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        .restore-modal-btn.primary {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
        }
        .restore-modal-btn.secondary {
            background: #e0e0e0;
            color: #333;
        }
        .restore-modal-btn.close {
            background: #e0e0e0;
            color: #333;
        }

        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            }
            .container {
                background: #1e1e2e;
            }
            h1 {
                color: #e0e0e0;
            }
            .subtitle {
                color: #a0a0b0;
            }
            .section-title {
                color: #e0e0e0;
                border-bottom-color: #3a3a4e;
            }
            .setting-item {
                background: #2a2a3e;
            }
            .setting-label {
                color: #e0e0e0;
            }
            .setting-description {
                color: #a0a0b0;
            }
            .selector-button {
                background: #2a2a3e;
                border-color: #3a3a4e;
                color: #a0a0b0;
            }
            .selector-button.active {
                background: linear-gradient(135deg, #667eea, #5c6bc0);
                color: white;
            }
            .backup-button {
                background: #2a2a3e;
            }
            .last-backup-info {
                color: #a0a0b0;
            }
            .danger-zone {
                background: #2e1a1a;
            }
            .reset-button {
                background: #2a2a3e;
            }
            .footer {
                border-top-color: #3a3a4e;
            }
        }

        /* PCç‰ˆã§æ–‡å­—ã‚µã‚¤ã‚ºè¨­å®šã‚’éè¡¨ç¤º */
        .top-nav {
            display: none;
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»PCå‘ã‘ */
        @media (min-width: 768px) {
            .top-nav {
                display: block;
                text-align: left;
                margin-bottom: 16px;
            }
            .top-nav-link {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                color: #5c6bc0;
                text-decoration: none;
                font-size: 14px;
                font-weight: 500;
                padding: 8px 16px;
                border-radius: 20px;
                background: #f0f2ff;
                transition: all 0.2s;
            }
            .top-nav-link:hover {
                background: #e0e4ff;
                color: #3949ab;
            }
            #fontSizeSetting {
                display: none;
            }
            .selector-button:hover {
                border-color: #5c6bc0;
                background: #f0f2ff;
            }
            .selector-button.active:hover {
                background: linear-gradient(135deg, #667eea, #5c6bc0);
            }
            .backup-button:hover {
                background: #f0f2ff;
            }
            .reset-button:hover {
                background: #ffebee;
            }
            .home-link:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-nav">
            <a href="index.html" class="top-nav-link">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </div>

        <div class="header">
            <h1>âš™ï¸ è¨­å®š</h1>
            <div class="subtitle">ã‚¢ãƒ—ãƒªã®è¨­å®šã‚’å¤‰æ›´ã§ãã¾ã™</div>
        </div>

        <!-- è¡¨ç¤ºè¨­å®š -->
        <div class="section">
            <div class="section-title">
                <span>ğŸ¨</span>
                è¡¨ç¤ºè¨­å®š
            </div>

            <div class="setting-item" id="fontSizeSetting">
                <div class="setting-label">æ–‡å­—ã®å¤§ãã•</div>
                <div class="setting-description">ã‚¯ã‚¤ã‚ºç”»é¢ã‚„ãƒœã‚¿ãƒ³ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã—ã¾ã™ï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å‘ã‘ï¼‰</div>
                <div class="button-selector" id="fontSizeSelector">
                    <button class="selector-button" data-value="small" onclick="setFontSize('small')">å°ã•ã‚</button>
                    <button class="selector-button active" data-value="normal" onclick="setFontSize('normal')">ãµã¤ã†</button>
                    <button class="selector-button" data-value="large" onclick="setFontSize('large')">å¤§ãã‚</button>
                </div>
            </div>
        </div>

        <!-- ã‚¯ã‚¤ã‚ºè¨­å®š -->
        <div class="section">
            <div class="section-title">
                <span>ğŸ“</span>
                ã‚¯ã‚¤ã‚ºè¨­å®š
            </div>

            <div class="setting-item">
                <div class="setting-label">ä»Šæ—¥ã®å•é¡Œæ•°</div>
                <div class="setting-description">ã€Œä»Šæ—¥ã®â—‹å•ã€ãƒ¢ãƒ¼ãƒ‰ã§å‡ºé¡Œã•ã‚Œã‚‹å•é¡Œæ•°ã‚’è¨­å®šã—ã¾ã™</div>
                <div class="button-selector" id="dailyCountSelector">
                    <button class="selector-button active" data-value="3" onclick="setDailyCount(3)">3å•</button>
                    <button class="selector-button" data-value="5" onclick="setDailyCount(5)">5å•</button>
                    <button class="selector-button" data-value="7" onclick="setDailyCount(7)">7å•</button>
                </div>
            </div>
        </div>

        <!-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š -->
        <div class="section">
            <div class="section-title">
                <span>ğŸ’¾</span>
                ãƒ‡ãƒ¼ã‚¿ä¿è­·
            </div>

            <div class="setting-item">
                <div class="setting-label">è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–“éš”</div>
                <div class="setting-description">ã‚¯ã‚¤ã‚ºã‚’æŒ‡å®šå›æ•°å®Œäº†ã™ã‚‹ã”ã¨ã«ã€å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒè‡ªå‹•ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™</div>
                <div class="button-selector" id="autoBackupSelector">
                    <button class="selector-button" data-value="3" onclick="setAutoBackupInterval(3); updateAutoBackupButtons(3)">3å›ã”ã¨</button>
                    <button class="selector-button active" data-value="5" onclick="setAutoBackupInterval(5); updateAutoBackupButtons(5)">5å›ã”ã¨</button>
                    <button class="selector-button" data-value="10" onclick="setAutoBackupInterval(10); updateAutoBackupButtons(10)">10å›ã”ã¨</button>
                </div>
            </div>

            <div class="setting-item">
                <div class="setting-label">æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</div>
                <div class="setting-description">å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ãƒ»å¾©å…ƒã§ãã¾ã™ã€‚ç«¯æœ«å¤‰æ›´æ™‚ã‚„ãƒ–ãƒ©ã‚¦ã‚¶ãƒ‡ãƒ¼ã‚¿å‰Šé™¤å‰ã«ã”åˆ©ç”¨ãã ã•ã„ã€‚</div>
                <div class="backup-buttons">
                    <button class="backup-button" onclick="downloadBackup()">ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
                    <button class="backup-button restore" onclick="startRestore()">ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§å¾©å…ƒ</button>
                    <input type="file" id="restoreInput" accept=".json" style="display: none;" onchange="handleRestoreFile(event)">
                </div>
                <div class="last-backup-info">
                    æœ€çµ‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: <span id="lastBackupDate">ç¢ºèªä¸­...</span>
                </div>
            </div>
        </div>

        <!-- å±é™ºã‚¾ãƒ¼ãƒ³ -->
        <div class="danger-zone">
            <div class="section-title">
                <span>âš ï¸</span>
                ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
            </div>
            <div class="setting-item" style="background: transparent; padding: 0;">
                <div class="setting-description">ã™ã¹ã¦ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</div>
                <button class="reset-button" onclick="confirmReset()">ğŸ—‘ï¸ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>

        <div class="footer">
            <a href="index.html" class="home-link">ğŸ  ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸</a>
        </div>
    </div>

    <!-- å¾©å…ƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="restorePreviewModal" class="restore-modal" style="display: none;">
        <div class="restore-modal-content">
            <div id="restorePreviewContent"></div>
        </div>
    </div>

    <script src="quizzes/quiz-config.js"></script>
    <script>
        // ----- ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º -----
        function setFontSize(size) {
            localStorage.setItem(SETTINGS_KEYS.fontSize, size);
            updateFontSizeButtons(size);
            applyFontSize();
        }

        function updateFontSizeButtons(size) {
            document.querySelectorAll('#fontSizeSelector .selector-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.value === size);
            });
        }

        function initFontSize() {
            const saved = localStorage.getItem(SETTINGS_KEYS.fontSize) || 'normal';
            updateFontSizeButtons(saved);
        }

        // ----- ä»Šæ—¥ã®å•é¡Œæ•° -----
        function setDailyCount(count) {
            localStorage.setItem(SETTINGS_KEYS.dailyCount, count.toString());
            updateDailyCountButtons(count);
        }

        function updateDailyCountButtons(count) {
            document.querySelectorAll('#dailyCountSelector .selector-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.value === count.toString());
            });
        }

        function initDailyCount() {
            const saved = localStorage.getItem(SETTINGS_KEYS.dailyCount) || '3';
            updateDailyCountButtons(parseInt(saved));
        }

        // ----- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–“éš” -----
        function updateAutoBackupButtons(interval) {
            document.querySelectorAll('#autoBackupSelector .selector-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.value === interval.toString());
            });
        }

        function initAutoBackupInterval() {
            const saved = getAutoBackupInterval();
            updateAutoBackupButtons(saved);
        }

        // ----- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–¢é€£ -----
        function getLastBackupDate() {
            const dateStr = localStorage.getItem(BACKUP_STORAGE_KEY);
            return dateStr ? new Date(dateStr) : null;
        }

        function formatDate(date) {
            if (!date) return 'ãªã—';
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}/${month}/${day}`;
        }

        function updateLastBackupDisplay() {
            const el = document.getElementById('lastBackupDate');
            if (el) {
                el.textContent = formatDate(getLastBackupDate());
            }
        }

        function downloadBackup() {
            const data = getQuizData();
            data.backupDate = new Date().toISOString();
            data.appVersion = '1.0';

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = generateBackupFileName();
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            setLastBackupDate();
            updateLastBackupDisplay();

            alert('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®‰å…¨ãªå ´æ‰€ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚');
        }

        // å¾©å…ƒé–‹å§‹ï¼ˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¦ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠï¼‰
        async function startRestore() {
            const proceed = await showRestoreGuideDialog();
            if (proceed) {
                document.getElementById('restoreInput').click();
            }
        }

        // å¾©å…ƒç”¨ã®ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿
        let pendingRestoreData = null;

        function handleRestoreFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    const validation = validateBackupData(data);

                    if (validation.valid) {
                        pendingRestoreData = data;
                        showRestorePreview(data);
                    } else {
                        showRestoreError(validation.error);
                    }
                } catch (error) {
                    showRestoreError('invalid_format');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function showRestorePreview(data) {
            const info = getBackupPreviewInfo(data);
            const modal = document.getElementById('restorePreviewModal');
            const content = document.getElementById('restorePreviewContent');

            content.innerHTML = `
                <div class="restore-preview-title success">âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª</div>
                <div class="restore-preview-info">
                    <div class="restore-preview-row">
                        <span class="restore-preview-label">ğŸ“… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ—¥</span>
                        <span class="restore-preview-value">${formatBackupDate(info.backupDate)}</span>
                    </div>
                    <div class="restore-preview-row">
                        <span class="restore-preview-label">ğŸ“ ç´¯è¨ˆå›ç­”æ•°</span>
                        <span class="restore-preview-value">${info.totalAnswered}å›</span>
                    </div>
                    <div class="restore-preview-row">
                        <span class="restore-preview-label">ğŸŒ¸ æº€ç‚¹ã‚¯ã‚¤ã‚º</span>
                        <span class="restore-preview-value">${info.perfectCount}å€‹</span>
                    </div>
                    <div class="restore-preview-row">
                        <span class="restore-preview-label">ğŸ… ç²å¾—ãƒãƒƒã‚¸</span>
                        <span class="restore-preview-value">${info.badgeCount}å€‹</span>
                    </div>
                </div>
                <div class="restore-warning">âš ï¸ ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™</div>
                <div class="restore-modal-buttons">
                    <button class="restore-modal-btn secondary" onclick="closeRestoreModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button class="restore-modal-btn primary" onclick="executeRestore()">å¾©å…ƒã™ã‚‹</button>
                </div>
            `;
            modal.style.display = 'flex';
        }

        function showRestoreError(errorType) {
            const modal = document.getElementById('restorePreviewModal');
            const content = document.getElementById('restorePreviewContent');

            let message = '';
            if (errorType === 'invalid_format') {
                message = 'ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br><br>ã€Œã²ã‹ã‚Šã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿_ã€ã§å§‹ã¾ã‚‹JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';
            } else if (errorType === 'no_quiz_data') {
                message = 'å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br><br>æ­£ã—ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';
            }

            content.innerHTML = `
                <div class="restore-preview-title error">âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“</div>
                <div class="restore-error-message">${message}</div>
                <div class="restore-modal-buttons">
                    <button class="restore-modal-btn close" onclick="closeRestoreModal()">é–‰ã˜ã‚‹</button>
                </div>
            `;
            modal.style.display = 'flex';
        }

        function executeRestore() {
            if (!pendingRestoreData) return;

            delete pendingRestoreData.backupDate;
            delete pendingRestoreData.appVersion;
            saveQuizData(pendingRestoreData);
            setLastBackupDate();

            closeRestoreModal();
            alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸï¼\nãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™ã€‚');
            location.reload();
        }

        function closeRestoreModal() {
            document.getElementById('restorePreviewModal').style.display = 'none';
            pendingRestoreData = null;
        }

        // ----- ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ -----
        function confirmReset() {
            if (confirm('âš ï¸ æœ¬å½“ã«ã™ã¹ã¦ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                if (confirm('æœ€çµ‚ç¢ºèª: æœ¬å½“ã«å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    localStorage.removeItem(STORAGE_KEY);
                    alert('å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚\nãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™ã€‚');
                    location.reload();
                }
            }
        }

        // ----- åˆæœŸåŒ– -----
        function initSettings() {
            initFontSize();
            initDailyCount();
            initAutoBackupInterval();
            updateLastBackupDisplay();
        }

        applyFontSize();
        initSettings();
    </script>
</body>
</html>
